% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/horseshoe_cates.R
\name{horseshoe_cates}
\alias{horseshoe_cates}
\title{Extract CATEs from a Fitted Horseshoe Object}
\usage{
horseshoe_cates(fit, X_test, n_x, n_d, X_sd = NULL, level = 0.95)
}
\arguments{
\item{fit}{An object of class \code{"horseshoe"}, or a list with a
\code{beta_draws} element (p x n_mcmc matrix).}

\item{X_test}{Numeric matrix of dimension n_test x n_x. Test covariate
values at which to evaluate the CATEs. These should be the raw
(unscaled) covariates.}

\item{n_x}{Integer. Number of covariate columns in the design matrix.}

\item{n_d}{Integer. Number of treatment dummy columns (contrasts).}

\item{X_sd}{Numeric vector of length p, or \code{NULL}. Column standard
deviations used for scaling. If \code{NULL} and \code{fit} has an
\code{X_sd} element, that is used. If no scaling was applied, leave
as \code{NULL}. Default: NULL.}

\item{level}{Numeric in (0, 1). Credible interval level. Default: 0.95.}
}
\value{
A list with components:
  \describe{
    \item{cate_hat}{n_test x n_d matrix: posterior mean iCATEs.}
    \item{cate_lo}{n_test x n_d matrix: lower credible interval bounds.}
    \item{cate_hi}{n_test x n_d matrix: upper credible interval bounds.}
    \item{n_test}{Integer: number of test observations.}
    \item{n_d}{Integer: number of treatment contrasts.}
    \item{n_draws}{Integer: number of MCMC draws used.}
    \item{level}{Numeric: CI level used.}
  }
}
\description{
Extracts individual-level conditional average treatment effects (iCATEs)
from posterior draws of a horseshoe regression with a multi-arm treatment
design. The design matrix must follow the saturated interaction layout:
\code{[X(n_x), D(n_d), X:D(n_d * n_x)]}.
}
\details{
For each treatment contrast \eqn{w = 1, \ldots, n_d}, the iCATE for
observation \eqn{i} is:
\deqn{\tau_w(x_i) = \gamma_w + x_i' \delta_w}
where \eqn{\gamma_w} is the treatment dummy coefficient and
\eqn{\delta_w} is the vector of treatment-covariate interaction
coefficients.


**Design matrix layout assumption**: The function assumes the design
matrix was constructed with columns in this order:
\enumerate{
  \item Columns 1 to n_x: Covariate main effects (X)
  \item Columns n_x+1 to n_x+n_d: Treatment dummies (D)
  \item Columns n_x+n_d+1 to end: Interactions (X:D), blocked by arm.
    That is, n_x columns for contrast 1, then n_x for contrast 2, etc.
}

The total number of columns must equal \code{n_x + n_d + n_d * n_x}.

**Rescaling**: If the horseshoe model was fit on a scaled design matrix
(\code{scale_X = TRUE}), the beta draws are in the scaled parameterization.
This function rescales them back to the original scale using \code{X_sd}
before computing CATEs. If \code{fit$X_sd} exists, it is used
automatically.
}
\examples{
\dontrun{
# Fit horseshoe on a design with 10 covariates and 3 treatment contrasts
# Design layout: [X(10), D(3), X:D(30)] = 43 columns total
fit <- horseshoe(y, X_design, penalized = pen_flags,
                 n_mcmc = 1000, burnin = 500)

# Extract CATEs at test points
cates <- horseshoe_cates(fit, X_test = X_covariates_test,
                         n_x = 10, n_d = 3)
head(cates$cate_hat)
}

}
